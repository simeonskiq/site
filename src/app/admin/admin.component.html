<div class="admin-container">
  <h1>{{ translations.panel || 'Administration Panel' }}</h1>

  <div class="cards">
    <div class="card" *ngIf="summary">
      <h2>{{ translations.pendingReservations || 'Pending Reservations' }}</h2>
      <p class="value">{{ summary.totalPendingReservations }}</p>
    </div>
    <div class="card" *ngIf="summary">
      <h2>{{ translations.occupancyRate || 'Occupancy Rate' }}</h2>
      <p class="value">{{ (summary.occupancyRate || 0) * 100 | number : '1.0-1' }}%</p>
    </div>
    <div class="card" *ngIf="summary">
      <h2>{{ translations.blockedRooms || 'Blocked Rooms' }}</h2>
      <p class="value">{{ summary.blockedRoomsCount }}</p>
    </div>
  </div>

  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <section class="section">
    <h2>{{ translations.pendingReservations || 'Pending Reservations' }}</h2>
    <div *ngIf="loading">{{ translations.loading || 'Loading reservations...' }}</div>
    <table *ngIf="!loading && pendingReservations.length" class="table">
      <thead>
        <tr>
          <th>{{ translations.id || 'ID' }}</th>
          <th>{{ translations.user || 'Name' }}</th>
          <th>Email</th>
          <th>{{ translations.room || 'Room' }}</th>
          <th>{{ translations.dates || 'Dates' }}</th>
          <th>{{ translations.status || 'Status' }}</th>
          <th>{{ translations.actions || 'Actions' }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of pendingReservations">
          <td attr.data-label="{{ translations.id || 'ID' }}">{{ formatBookingId(r) }}</td>
          <td attr.data-label="{{ translations.user || 'Name' }}">{{ (r.FirstName || r.GuestFirstName || '') + ' ' + (r.LastName || r.GuestLastName || '') }}</td>
          <td data-label="Email">{{ r.Email || r.GuestEmail }}</td>
          <td attr.data-label="{{ translations.room || 'Room' }}">{{ r.RoomName }}</td>
          <td attr.data-label="{{ translations.dates || 'Dates' }}">{{ r.StartDate | date }} – {{ r.EndDate | date }}</td>
          <td attr.data-label="{{ translations.status || 'Status' }}">
            <span [class.status-canceled]="r.Status === 'Cancelled'">{{ r.DisplayStatus || r.Status }}</span>
          </td>
          <td attr.data-label="{{ translations.actions || 'Actions' }}">
            <button (click)="approveReservation(r.Id)" class="btn btn-approve">
              {{ translations.approve || 'Approve' }}
            </button>
            <button (click)="rejectReservation(r.Id)" class="btn btn-reject">
              {{ translations.reject || 'Reject' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="!loading && !pendingReservations.length">{{ translations.noPending || 'No pending reservations.' }}</p>
  </section>

  <section class="section">
    <h2>Awaiting confirmation</h2>
    <table *ngIf="awaitingConfirmation.length" class="table">
      <thead>
        <tr>
          <th>{{ translations.id || 'ID' }}</th>
          <th>{{ translations.user || 'Name' }}</th>
          <th>Email</th>
          <th>{{ translations.room || 'Room' }}</th>
          <th>{{ translations.dates || 'Dates' }}</th>
          <th>{{ translations.status || 'Status' }}</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of awaitingConfirmation">
          <td>{{ formatBookingId(r) }}</td>
          <td>{{ (r.FirstName || r.GuestFirstName || '') + ' ' + (r.LastName || r.GuestLastName || '') }}</td>
          <td>{{ r.Email || r.GuestEmail }}</td>
          <td>{{ r.RoomName }}</td>
          <td>{{ r.StartDate | date }} – {{ r.EndDate | date }}</td>
          <td>{{ r.DisplayStatus || r.Status }}</td>
          <td>
            <button class="btn btn-cancel" (click)="changeStatus(r.Id, 'Cancelled')">{{ translations.cancel || 'Cancel' }}</button>
            <button class="btn btn-complete" (click)="changeStatus(r.Id, 'Completed')">{{ translations.complete || 'Complete' }}</button>
          </td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="!awaitingConfirmation.length">No approved reservations awaiting confirmation.</p>
  </section>

  <section class="section">
    <h2>{{ translations.roomsAvailability || 'Rooms & Availability' }}</h2>
    <table *ngIf="rooms.length" class="table">
      <thead>
        <tr>
          <th>{{ translations.name || 'Name' }}</th>
          <th>{{ translations.type || 'Type' }}</th>
          <th>{{ translations.status || 'Status' }}</th>
          <th>{{ translations.visible || 'Visible' }}</th>
          <th>{{ translations.currentlyBlocked || 'Currently Blocked' }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let room of rooms">
          <td attr.data-label="{{ translations.name || 'Name' }}">{{ room.Name }}</td>
          <td attr.data-label="{{ translations.type || 'Type' }}">{{ room.Type }}</td>
          <td attr.data-label="{{ translations.status || 'Status' }}">{{ room.Status }}</td>
          <td attr.data-label="{{ translations.visible || 'Visible' }}">{{ room.VisibleToUsers ? (translations.yes || 'Yes') : (translations.no || 'No') }}</td>
          <td attr.data-label="{{ translations.currentlyBlocked || 'Currently Blocked' }}">{{ room.IsCurrentlyBlocked ? (translations.yes || 'Yes') : (translations.no || 'No') }}</td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="!rooms.length">{{ translations.noRooms || 'No rooms defined yet.' }}</p>
  </section>

  <section class="section">
    <h2>{{ translations.reservationHistory || 'Reservation History' }}</h2>
    
    <!-- Search Section -->
    <div class="search-section">
      <div class="search-group">
        <label for="searchEmail">{{ translations.searchEmail || 'Search by Email:' }}</label>
        <input 
          type="text" 
          id="searchEmail"
          [(ngModel)]="searchEmail"
          (input)="applyFilters()"
          placeholder="Email address..."
          class="search-input">
      </div>
      <div class="search-group">
        <label for="searchDate">{{ translations.searchDate || 'Search by Date:' }}</label>
        <input 
          type="date" 
          id="searchDate"
          [(ngModel)]="searchDate"
          (change)="applyFilters()"
          class="search-input">
      </div>
      <div class="search-group">
        <label for="searchTag">{{ translations.searchTag || 'Search by Status/Tag:' }}</label>
        <input 
          type="text" 
          id="searchTag"
          [(ngModel)]="searchTag"
          (input)="applyFilters()"
          placeholder="e.g., Approved, Completed..."
          class="search-input">
      </div>
      <div class="search-group">
        <label for="searchRoom">{{ translations.searchRoom || 'Search by Room:' }}</label>
        <input 
          type="text" 
          id="searchRoom"
          [(ngModel)]="searchRoom"
          (input)="applyFilters()"
          placeholder="Room name..."
          class="search-input">
      </div>
      <button 
        *ngIf="searchEmail || searchDate || searchTag || searchRoom" 
        class="btn-clear" 
        (click)="clearSearch()">
        {{ translations.clearSearch || 'Clear Search' }}
      </button>
    </div>

    <table *ngIf="filteredReservations.length" class="table">
      <thead>
        <tr>
          <th>{{ translations.id || 'ID' }}</th>
          <th>{{ translations.user || 'Name' }}</th>
          <th>Email</th>
          <th>{{ translations.room || 'Room' }}</th>
          <th>{{ translations.dates || 'Dates' }}</th>
          <th>{{ translations.status || 'Status' }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of getPaginatedReservations()">
          <td attr.data-label="{{ translations.id || 'ID' }}">{{ formatBookingId(r) }}</td>
          <td attr.data-label="{{ translations.user || 'Name' }}">{{ (r.FirstName || r.GuestFirstName || '') + ' ' + (r.LastName || r.GuestLastName || '') }}</td>
          <td data-label="Email">{{ r.Email || r.GuestEmail }}</td>
          <td attr.data-label="{{ translations.room || 'Room' }}">{{ r.RoomName }}</td>
          <td attr.data-label="{{ translations.dates || 'Dates' }}">{{ r.StartDate | date }} – {{ r.EndDate | date }}</td>
          <td attr.data-label="{{ translations.status || 'Status' }}">{{ r.DisplayStatus || r.Status }}</td>
        </tr>
      </tbody>
    </table>
    
    <!-- Pagination -->
    <div *ngIf="filteredReservations.length > 0" class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        {{ translations.previous || 'Previous' }}
      </button>
      <span class="pagination-info">
        {{ translations.page || 'Page' }} {{ currentPage }} {{ translations.of || 'of' }} {{ totalPages }} ({{ filteredReservations.length }} {{ translations.total || 'total' }})
      </span>
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        {{ translations.next || 'Next' }}
      </button>
    </div>
    
    <p *ngIf="!filteredReservations.length && !loading">
      <span *ngIf="searchEmail || searchDate || searchTag || searchRoom">
        {{ translations.noResults || 'No reservations found matching your search criteria.' }}
      </span>
      <span *ngIf="!searchEmail && !searchDate && !searchTag && !searchRoom">
        {{ translations.noReservations || 'No reservations yet.' }}
      </span>
    </p>
  </section>
</div>


